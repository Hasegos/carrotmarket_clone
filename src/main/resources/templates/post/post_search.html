<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>거래 매물 검색</title>
    <link rel="stylesheet" href="/css/pages/post-list.css">
</head>
<body class="font-pretendard" id="post-list__search">
    <header th:replace="~{fragments/header :: header}"></header>
    <div class="post-list_search-result">
        <div class="post-list_search-keyword">"<span th:text="${keyword}"></span>" 검색 결과</div>
        <div class="post-list__search-container">
            <div class="post-list__category-container">
                <div class="post-list__category-title">카테고리</div>
                <form id="post-list__category-form" th:action="@{/posts/search}" method="get">
                    <input type="hidden" name="keyword" th:value="${keyword}" />
                    <div th:each="cate : ${categories}">
                        <label><input type="radio" name="category"
                                      class="post-list__category-radio"
                                      th:value="${cate.id}"
                                      th:checked="${category} == ${cate.id}">
                            <span th:text="${cate.name}"></span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="post-list__search-content">
                <div th:if="${hasKeyword and (page == null or #lists.isEmpty(page.content))}" class="post-list__empty">
                    <p>검색 결과가 없습니다.</p>
                </div>
                <div th:if="${page != null and !#lists.isEmpty(page.content)}" class="post-list__grid">
                    <div th:each="post : ${page.content}" class="post-list__card">
                        <a th:href="@{/posts/{id}(id=${post?.id})}" class="post-list__card-link">
                            <div class="post-list__card-badge" th:if="${post.sold}">판매완료</div>
                            <div class="post-list__image-wrapper">
                                <img class="post-list__card-image" th:if="${post.images != null and post.images.size() > 0}" th:src="@{${post.images[0].imageUrl}}" alt="첫번째 이미지">
                                <img class="post-list__card-image" th:if="${post.images == null or post.images.size() == 0}" src="https://placehold.co/210x210" alt="이미지 없음">
                            </div>
                            <div class="post-list__card-info">
                                <div class="post-list__card-title" th:text="${post?.title ?: '제목 없음'}">제목</div>
                                <div class="post-list__card-price">
                                    <span th:text="${#numbers.formatDecimal(post?.price, 0, 'COMMA', 0, 'POINT') ?: '0'}">가격</span>원</div>
                                <div class="post-list__card-location" th:text="${post?.location ?: '장소 없음'}"></div>
                                <div class="post-list__card-detail">조회 <span th:text="${post?.viewCount ?: '0'}"></span> ·
                                    채팅 <span th:text="${post?.getChatRoomsCount() ?: '0'}"></span></div>
                            </div>
                        </a>
                    </div>
                </div>

                <div th:if="${page != null && page.totalPages > 1}" class="post-list__pagination">
                    <a th:if="${page.hasPrevious()}" class="post-list__pagination-link--enabled"
                       th:href="@{/posts/search(page=${page.number-1}, keyword=${keyword}, category=${category})}">&lt;</a>
                    <span th:unless="${page.hasPrevious()}" class="post-list__pagination-link--disabled">&lt;</span>
                    <span class="current" th:text="(${page.number}+1) + ' / ' + ${page.totalPages}">1 / 1</span>
                    <a th:if="${page.hasNext()}" class="post-list__pagination-link--enabled"
                       th:href="@{/posts/search(page=${page.number+1}, keyword=${keyword}, category=${category})}">&gt;</a>
                    <span th:unless="${page.hasNext()}" class="post-list__pagination-link--disabled">&gt;</span>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/header.js"></script>
    <script>
        document.querySelectorAll('.post-list__category-radio').forEach(radio => {
          radio.addEventListener('change', function() {
            document.getElementById('post-list__category-form').submit();
          });
        });
    </script>

</body>
</html>